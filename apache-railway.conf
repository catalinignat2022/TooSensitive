# Apache configuration for Railway deployment
# Fixes ServerName warnings and optimizes for cloud environment

ServerName ${APACHE_SERVER_NAME}
ServerAlias ${RAILWAY_PUBLIC_DOMAIN}
ServerTokens Prod
ServerSignature Off

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"

# Enable compression
LoadModule deflate_module modules/mod_deflate.so
<Location />
    SetOutputFilter DEFLATE
    SetEnvIfNoCase Request_URI \
        \.(?:gif|jpe?g|png|ico)$ no-gzip dont-vary
    SetEnvIfNoCase Request_URI \
        \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
</Location>

# Cache static files
<LocationMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg)$">
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
    Header append Cache-Control "public"
</LocationMatch>

# WordPress specific optimizations
<Directory "/var/www/html">
    Options -Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
    
    # Protect sensitive WordPress files
    <Files "wp-config.php">
        Require all denied
    </Files>
    
    <Files "readme.html">
        Require all denied
    </Files>
    
    <Files "license.txt">
        Require all denied
    </Files>
</Directory>

# Block access to sensitive directories
<DirectoryMatch "^.*/\.(git|svn|hg)/">
    Require all denied
</DirectoryMatch>

# Log configuration
LogLevel warn
ErrorLog /var/log/apache2/error.log
CustomLog /var/log/apache2/access.log combined